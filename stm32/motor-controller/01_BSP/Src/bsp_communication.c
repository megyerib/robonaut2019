////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//!
//!  \file      bsp_communication.c
//!  \brief
//!  \details
//!
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Includes ------------------------------------------------------------------------------------------------------------

#include "bsp_communication.h"
#include "stm32f0xx_hal.h"
#include "usart.h"

// Defines -------------------------------------------------------------------------------------------------------------

#define MAIN_BOARD_UART &huart1

// Typedefs ------------------------------------------------------------------------------------------------------------

// Local (static) & extern variables -----------------------------------------------------------------------------------

unsigned char rx[20];
unsigned char response[] = "lol\r\n";
int i;

// Local (static) function prototypes ----------------------------------------------------------------------------------

// Global function definitions -----------------------------------------------------------------------------------------

void initComm()
{
	i = 0;
	HAL_UART_Receive_IT(MAIN_BOARD_UART, &rx[i], 1);
}

void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
	if (huart == MAIN_BOARD_UART)
	{
		if (rx[i] == '\n')
		{
			HAL_UART_Transmit_IT(MAIN_BOARD_UART, response, 5);
			i = 0;
		}
		else
		{
			i++;
		}

		HAL_UART_Receive_IT(MAIN_BOARD_UART, &rx[i], 1);
	}
}

// Local (static) function definitions ---------------------------------------------------------------------------------

// END -----------------------------------------------------------------------------------------------------------------
